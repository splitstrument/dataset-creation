# quality-tool

This tool is used to skim through stems to determine their audio quality for use as training data, controlled through
keyboard inputs without a visual interface.

The tool steps through all tracks and stems of a given instrument, skipping previously listened to tracks. A stem is
split into parts for easier traversal. During playback, a track can be marked as being unsuitable as training data for
several reasons. See [Controls](#controls) for different marking options.

Stems are immediately skipped upon marking, unless the tool is started in [`cautious-mode`](#parameters). When not
skipping stems immediately, pressing the same marking hotkey again will remove the mark. Marks are only written to the
filesystem upon listening through all stems of a track for a given instrument.

The parameter [`save-marks-metadata`](#parameters) writes any marks to a file named `marks_<instrument>.yaml` in the
script folder. This file can be used in case of data loss to reconstruct any made marks based on the track folder name.
If `marks_<instrument>.yaml` already exists, additional marks will be added to it.

## Controls

| Hotkey | Action                                                                                |
|--------|---------------------------------------------------------------------------------------|
| Space  | Play next split of current stem if any remain, change to next stem or track otherwise |
| Enter  | Skip to next stem and write marks to track, if any have been made                     |
| Q      | Mark as having bad quality                                                            |
| B      | Mark as having bleed from other stems                                                 |
| L      | Mark as being labeled as the wrong instrument                                         |
| M      | Mark as having no audio data in the entire stem                                       |
| I      | Mark as being inaudible because of volume or other recording related problems         |
| A      | Mark as being audible (mainly used to counteract previous 'inaudible' markings)       |
| D      | Mark as needing a detailed check when a quick listen through did not suffice          |

## Requirements

Install `ffmpeg` or `avconv` on your system. Apparently installing ffmpeg with pip alone is no longer enough.

## Parameters

| Option                   | Description                                                                                                                                         | Required | Default | Example                                          |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|----------|---------|--------------------------------------------------|
| --source-folder          | path to folder containing tracks as generated by `data_organizer`                                                                                   | X        | -       | --source-folder=D:\ba_data\test                  |
| --instrument             | instrument to check                                                                                                                                 |          | mix     | --instrument=piano                               |
| --splits                 | how many parts per stem should be generated to skim through                                                                                         |          | 5       | --splits=5                                       |
| --cautious-mode          | marker will not immediately skip the current stem when marking it, allowing additional marks or reversing previous mark                             |          | False   | --cautious-mode false                            |
| --save-marks-metadata    | whether marks should be written to separate file for safekeeping, in case of data loss                                                              |          | False   | --save-marks-metadata true                       |
| --from-index             | from what track to start                                                                                                                            |          | -       | --from-index=50                                  |
| --to-index               | at what track to stop                                                                                                                               |          | -       | --to-index=60                                    |
| --additional-instruments | what additional instruments to listen to, for instance distortion_guitar when checking for guitar. marks are still only written for main instrument |          |         | --additional-instruments distortion_guitar piano |

# Metadata

TODO describe